# Отчет о лаботаротоной работе №4

Технологии работы с базами данных. JPA. Spring Data

## Цель работы

В этой работе мы перейдем с использование Spring JDBC на использование ORM Hibernate и Spring Data. Расширим наше приложение новыми сущностями и приведем структуру приложения в соответствие со "слоистой архитектурой".

## Выполнение работы

1. Создание проекта и настройка зависимостей:  
   Создал новый проект, инициализировал gradle с помощью `gradle init`. Добавил в проект зависимости для Spring Data и JPA, а также для работы с базой данных H2 и HikariCP.

2. Настройка DataSource:  
   Используя HikariCP, настроил DataSource для работы с встраиваемой базой данных H2. При запуске приложения БД создается автоматически на основе JPA-сущностей.

3. Структура проекта была приведена к следующему виду:

- ru.bsuedu.cad.lab - основной пакет
  - ru.bsuedu.cad.lab.entity - JPA сущности
   - ru.bsuedu.cad.lab.repository - репозитории
   - ru.bsuedu.cad.lab.service - сервисы
   - ru.bsuedu.cad.lab.app - приложение

4. Создал JPA сущности:
   - **Product** (Товар)
   - **Category** (Категория)
   - **Customer** (Клиент)
   - **Order** (Заказ)
   - **OrderDetail** (Детали заказа)

5. Создание репозиториев `cad-2025\les08\lab\app\src\main\java\ru\bsuedu\cad\lab\repository`:
   Для каждой сущности был создан репозиторий с методами для выполнения основных операций (сохранение, получение по ID, получение всех записей):
   - **ProductRepository** (Товар)
   - **CategoryRepository** (Категория)
   - **CustomerRepository** (Клиент)
   - **OrderRepository** (Заказ)
   - **OrderDetailRepository** (Детали заказа)

6. Сервис создания заказа `cad-2025\les08\lab\app\src\main\java\ru\bsuedu\cad\lab\service\OrderService.java`:
   Был реализован сервис для создания нового заказа и получения всех заказов.

7. Работа с CSV-файлами:
   Для добавления данных в базу данных использовались CSV-файлы, содержащие информацию о категориях, продуктах и клиентах. Эти данные были загружены в базу с помощью специального класса.

8. Запуск приложения:  
   Приложение успешно запускается с помощью команды `gradle run`, корректно выводит информацию о заказах и завершает свою работу без ошибок. ВАЖНО: в ОС Windows могут быть проблемы с кодировкой, поэтому корректное отображение Кириллицы не гарантировано.

## Выводы

В процессе выполнения лабораторной работы было освоено применение Spring Data и JPA для работы с базой данных. Были созданы JPA-сущности, настроены репозитории и сервисы для работы с заказами, а также реализована обработка транзакций. Приложение успешно взаимодействует с встраиваемой базой данных H2 и использует Hibernate для управления сущностями. Все задачи лабораторной работы выполнены успешно.

## Контрольные вопросы

### JPA

1. **Что такое JPA и для чего оно используется?**
   JPA (Java Persistence API) — это спецификация для работы с базами данных в Java. Она упрощает взаимодействие с базами данных, позволяя работать с объектами вместо SQL-запросов. JPA предоставляет стандарты для создания, чтения, обновления и удаления данных через объекты Java.

2. **Чем JPA отличается от Hibernate?**
   Hibernate — это одна из реализаций JPA. JPA является стандартом, в то время как Hibernate предоставляет конкретную реализацию этого стандарта, добавляя собственные возможности для работы с базой данных.

3. **Что делает аннотация @Entity?**
   Аннотация `@Entity` используется для обозначения класса как сущности, которую нужно сохранять в базу данных. Классы с этой аннотацией автоматически маппятся в таблицы базы данных.

4. **Для чего нужна аннотация @Table?**
   Аннотация `@Table` используется для указания имени таблицы в базе данных, которая будет соответствовать сущности. Если имя таблицы не указано, оно будет автоматически сгенерировано на основе имени класса.

5. **Как обозначить первичный ключ в JPA?**
   Для обозначения первичного ключа используется аннотация `@Id`, которая ставится на поле или метод, представляющий уникальный идентификатор объекта.

6. **Что делает аннотация @GeneratedValue?**
   Аннотация `@GeneratedValue` указывает, что значение поля будет генерироваться автоматически. Она может использоваться для указания стратегии генерации (например, автоинкремент в базе данных).

7. **Какие бывают стратегии генерации идентификаторов в JPA?**
   В JPA существуют следующие стратегии генерации идентификаторов:

   - `AUTO` — Hibernate сам выбирает стратегию.
   - `IDENTITY` — генерация идентификатора с использованием автоинкремента.
   - `SEQUENCE` — генерация идентификатора с использованием последовательности.
   - `TABLE` — генерация идентификатора с использованием специальной таблицы для хранения значений.

8. **Чем отличается @Column(name = "field_name") от использования имени поля напрямую?**
   Аннотация `@Column(name = "field_name")` позволяет указать имя столбца в базе данных, которое будет соответствовать полю в сущности. Это полезно, если имя поля в базе данных отличается от имени переменной в Java-классе.

9. **Как задать связь “один ко многим” (@OneToMany) в JPA?**
   Связь "один ко многим" задается с помощью аннотации `@OneToMany`. Она указывает, что один объект связан с множеством других объектов. Например, один заказ может содержать несколько заказанных товаров.

10. **Как задать связь “многие ко многим” (@ManyToMany) в JPA?**
    Связь "многие ко многим" задается с помощью аннотации `@ManyToMany`. Эта аннотация используется для указания, что один объект может быть связан с множеством других объектов, и наоборот.

### Spring Data

1. **Что такое Spring Data и зачем оно нужно?**
   Spring Data — это проект, который упрощает взаимодействие с базой данных и интеграцию с различными хранилищами данных (например, SQL, NoSQL). Он предоставляет абстракции для репозиториев, упрощая разработку операций с данными.

2. **Что делает интерфейс CrudRepository?**
   `CrudRepository` предоставляет базовые операции CRUD (Create, Read, Update, Delete) для работы с сущностями. Он включает методы, такие как `save()`, `findById()`, `findAll()`, `delete()`, и другие.

3. **Чем JpaRepository отличается от CrudRepository?**
   `JpaRepository` является расширением `CrudRepository` и предоставляет дополнительные методы для работы с JPA, такие как `findAll(Sort sort)`, `findAll(Pageable pageable)` и поддержку пагинации.

4. **Как создать свой репозиторий в Spring Data JPA?**
   Для создания собственного репозитория нужно создать интерфейс, который наследует `JpaRepository` или `CrudRepository` и указывает тип сущности и тип идентификатора.

5. **Как выполнить поиск по ID с помощью Spring Data JPA?**
   Для поиска записи по ID используется метод `findById()`, предоставляемый репозиторием, который возвращает `Optional<T>`, где T — это тип сущности.

6. **Как добавить новую запись в базу данных через Spring Data JPA?**
   Для добавления новой записи используется метод `save()`, который сохраняет сущность в базу данных.

7. **Как удалить объект из базы данных в Spring Data JPA?**
   Для удаления объекта из базы данных используется метод `delete()`, который удаляет сущность по её идентификатору.

8. **Как написать свой SQL-запрос в Spring Data JPA?**
   Для написания собственных SQL-запросов в Spring Data JPA можно использовать аннотацию `@Query`, где можно указать произвольный JPQL или SQL-запрос.

9. **Что такое @Transactional и зачем она нужна?**
   Аннотация `@Transactional` используется для указания, что метод или класс должны выполняться в рамках транзакции. Это гарантирует, что операции с базой данных будут атомарными.

10. **Какие аннотации нужны для работы с JPA-сущностями?**
    Для работы с JPA-сущностями необходимы следующие аннотации: `@Entity`, `@Table`, `@Id`, `@GeneratedValue`, `@Column`, а также аннотации для связей, такие как `@OneToMany`, `@ManyToOne`, и `@ManyToMany`.
